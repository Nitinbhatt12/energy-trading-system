# Energy Trading System in C

## Description

The Energy Trading System is a command-line application developed in C to manage and analyze energy trading transactions. It utilizes B-Trees for efficient storage, retrieval, and ordered operations on various data entities, including transactions, sellers, buyers, and seller-buyer pairs. The system allows users to add new transactions, view comprehensive reports, query data based on different criteria, and persists data to text files.

## Features

The system offers the following functionalities:

1.  **Add New Transaction:** Allows users to input details for a new energy transaction. The system automatically calculates the price based on seller-specific rates (if the seller exists) or prompts for new seller rates. It updates transaction logs, seller records, buyer records, and seller-buyer pair statistics.
2.  **Display All Transactions:** Shows a list of all recorded transactions in chronological order (based on insertion or transaction ID).
3.  **Display Transactions by Seller:** For each seller, lists their details (ID, pricing tiers, total revenue) and all associated transactions.
4.  **Display Regular Buyers:** For each seller, lists buyers who have conducted more than a certain number of transactions (currently > 5) with them.
5.  **Display Transactions by Buyer:** For each buyer, lists their details (ID, total energy purchased) and all associated transactions.
6.  **Find Transactions in Time Period:** Retrieves and displays transactions that occurred within a user-specified start and end timestamp.
7.  **Calculate Total Revenue by Seller:** Calculates and displays the total revenue generated by a specific seller.
8.  **Find Transactions by Energy Amount Range:** Displays transactions with energy amounts falling within a specified minimum and maximum range, sorted in increasing order of energy amount.
9.  **Sort Buyers by Energy Purchased:** Displays a list of all buyers, sorted in ascending order based on the total energy they have purchased.
10. **Display Seller-Buyer Pairs:** Shows seller-buyer pairs sorted by the total number of transactions they have conducted together, along with their transaction history.
11. **Data Persistence:** Reads initial seller and transaction data from `sellertable.txt` and `energytrading.txt` respectively. Writes updated data back to these files upon exiting the program.
12. **Input Validation:** Includes checks for valid ID formats, positive energy amounts, and correct timestamp formats.

## Data Structures Used

The project extensively uses B-Trees and linked lists for efficient data management:

*   **B-Trees (Order M=4):**
    *   **Main Transaction B-Tree:** Stores all `transaction_node` data, keyed by `transaction_id`.
    *   **Seller B-Tree:** Stores `seller_node` data, keyed by `seller_id`. Each `seller_node` contains:
        *   Seller details (ID, pricing tiers, total revenue).
        *   A pointer to a sub-B-Tree (`Transaction_Subtree`) storing all transactions involving this seller.
        *   A linked list (`regularBuyers`) of buyers who frequently transact with this seller.
    *   **Buyer B-Tree:** Stores `buyer_node` data, keyed by `buyer_id`. Each `buyer_node` contains:
        *   Buyer details (ID, total energy purchased).
        *   A pointer to a sub-B-Tree (`Transaction_Subtree`) storing all transactions involving this buyer.
    *   **Seller-Buyer Pair B-Tree:** Stores `pair_node` data, keyed by a concatenated `pair_id` (seller_id + buyer_id). Each `pair_node` contains:
        *   Pair details (seller ID, buyer ID, number of transactions).
        *   A pointer to a sub-B-Tree (`Transaction_Subtree`) storing all transactions between this specific seller and buyer.
*   **Linked Lists:**
    *   Used within `seller_node` to maintain a list of `regularBuyer`s.

## Key Constants

Defined in `energytrading.h`:

*   `M = 4`: Order of the B-Trees.
*   `ID_SIZE = 6`: Maximum length for Transaction, Seller, and Buyer IDs.
*   `DATE_SIZE = 25`: Buffer size for timestamp strings.
*   `MAX_BUYERS = 100`: Maximum number of buyers for sorting/collecting purposes.
*   `MAX_PAIR = 100`: Maximum number of pairs for sorting/collecting purposes.

## File Structure

*   `energytrading.h`: Header file containing all structure definitions, global constants, and function prototypes.
*   `main.c`: Contains the `main` function, user interface menu, and orchestrates calls to other modules.
*   `transaction.c`: Functions related to creating and processing `transaction_node` data.
*   `trans_tree.c`: B-Tree implementation specific to `transaction_node` (for the main transaction log and sub-trees).
*   `seller.c`: Functions for seller-specific operations like displaying seller lists and regular buyers.
*   `seller_tree.c`: B-Tree implementation for `seller_node`.
*   `buyer.c`: Functions for buyer-specific operations like displaying buyer lists and sorting.
*   `buyer_tree.c`: B-Tree implementation for `buyer_node`.
*   `pair.c`: Functions for pair-specific operations like displaying pair lists and sorting.
*   `pair_tree.c`: B-Tree implementation for `pair_node`.
*   `display.c`: Utility functions for printing data in tabular format.
*   `fileoperation.c`: Functions for reading data from and writing data to text files (`energytrading.txt`, `sellertable.txt`).
*   `freememory.c`: Functions for deallocating all dynamically allocated memory for B-Trees and linked lists.
*   `utils.c`: Utility functions for input validation (IDs, timestamps, price) and generating current timestamps.

## Data Files

The system uses two primary data files:

*   **`energytrading.txt`**: Stores transaction records.
    *   Format: `TransactionID,SellerID,BuyerID,AmountEnergy,Timestamp`
    *   Example: `T1111,S1114,B1115,500,2024-10-31 20:15:00`
*   **`sellertable.txt`**: Stores seller pricing information.
    *   Format: `SellerID,Price_KWh_LT_300,Price_KWh_GT_300`
    *   Example: `S1111,0.32,0.35`

These files are read at startup and written to upon exiting the program.

## How to Compile

Ensure all `.c` and `.h` files are in the same directory. Use a C compiler (like GCC) to compile the project.

```bash
gcc -o energy buyer_tree.c buyer.c display.c fileoperation.c freememory.c main.c pair_tree.c pair.c seller_tree.c seller.c trans_tree.c transaction.c utils.c
```
*(Note: If `energytrading.h` were in an `include` subdirectory, you would add `-Iinclude` to the command.)*

## How to Run

After successful compilation, run the executable:

```bash
./energy
```

This will start the application and display the main menu.

## Menu Options

1.  **Add New Transaction**: Add a new energy sale record.
2.  **Display All Transactions**: List all transactions.
3.  **Display Transactions by Seller**: Show transactions grouped by seller.
4.  **Display Regular Buyers**: List frequent buyers for each seller.
5.  **Display Transactions by Buyer**: Show transactions grouped by buyer.
6.  **Find Transactions in Time Period**: Filter transactions by date/time range.
7.  **Calculate Total Revenue by Seller**: Show total earnings for a specific seller.
8.  **Find Transactions by Energy Amount Range**: Filter transactions by energy amount, sorted.
9.  **Sort Buyers by Energy Purchased**: List buyers ordered by total energy bought.
10. **Display Seller-Buyer Pairs sorted by number of transaction**: Show trading pairs by transaction volume.
0.  **Exit**: Save data and close the application.

```
